
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Built-in Objects Â· Beidou Document</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../website-1510989186484.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="env.html" />
    
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    About Beidou
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../quick-start/quick-start.html">
            
                <a href="../quick-start/quick-start.html">
            
                    
                    Quick Start
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Step by Step
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../quick-start/prepare-environment.html">
            
                <a href="../quick-start/prepare-environment.html">
            
                    
                    Environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../quick-start/directory-struct.html">
            
                <a href="../quick-start/directory-struct.html">
            
                    
                    Directory Structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../quick-start/step-by-step.html">
            
                <a href="../quick-start/step-by-step.html">
            
                    
                    Step by Step
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Basics
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.4.1" data-path="objects.html">
            
                <a href="objects.html">
            
                    
                    Built-in Objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="env.html">
            
                <a href="env.html">
            
                    
                    Runtime Environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="config.html">
            
                <a href="config.html">
            
                    
                    Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="plugins.html">
            
                <a href="plugins.html">
            
                    
                    Plugins
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="middleware.html">
            
                <a href="middleware.html">
            
                    
                    Middlewares
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="router.html">
            
                <a href="router.html">
            
                    
                    Router
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="controller.html">
            
                <a href="controller.html">
            
                    
                    Controller
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="service.html">
            
                <a href="service.html">
            
                    
                    Service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="schedule.html">
            
                <a href="schedule.html">
            
                    
                    Schedule
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="extend.html">
            
                <a href="extend.html">
            
                    
                    Extend
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.11" data-path="Mock.html">
            
                <a href="Mock.html">
            
                    
                    Mock
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.12" data-path="app-start.html">
            
                <a href="app-start.html">
            
                    
                    Custom startup
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    Core
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../core/development.html">
            
                <a href="../core/development.html">
            
                    
                    Development
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../core/unittest.html">
            
                <a href="../core/unittest.html">
            
                    
                    Unit Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../core/logger.html">
            
                <a href="../core/logger.html">
            
                    
                    Logger
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../core/http-client.html">
            
                <a href="../core/http-client.html">
            
                    
                    HttpClient
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../core/cookie-and-session.html">
            
                <a href="../core/cookie-and-session.html">
            
                    
                    Cookie & Session
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../core/cluster-and-ipc.html">
            
                <a href="../core/cluster-and-ipc.html">
            
                    
                    Cluster and IPC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../core/isomorphic-render.html">
            
                <a href="../core/isomorphic-render.html">
            
                    
                    Ismorphic Render
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="../core/error-handling.html">
            
                <a href="../core/error-handling.html">
            
                    
                    Error Handling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="../core/security.html">
            
                <a href="../core/security.html">
            
                    
                    Security
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="../core/i18n.html">
            
                <a href="../core/i18n.html">
            
                    
                    Multi-language
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Deployment
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../deployment/deployment.html">
            
                <a href="../deployment/deployment.html">
            
                    
                    Deployment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../deployment/devops.html">
            
                <a href="../deployment/devops.html">
            
                    
                    DevOps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../deployment/docker.html">
            
                <a href="../deployment/docker.html">
            
                    
                    Docker
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    Tutorials
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../tutorials/progressive.html">
            
                <a href="../tutorials/progressive.html">
            
                    
                    Progressive
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../tutorials/mysql.html">
            
                <a href="../tutorials/mysql.html">
            
                    
                    MySQL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../tutorials/restful.html">
            
                <a href="../tutorials/restful.html">
            
                    
                    Restful API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../tutorials/async-function.html">
            
                <a href="../tutorials/async-function.html">
            
                    
                    Async Function
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    Advanced
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../advanced/architecture.html">
            
                <a href="../advanced/architecture.html">
            
                    
                    How It Works
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../advanced/loader.html">
            
                <a href="../advanced/loader.html">
            
                    
                    Loader
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../advanced/plugin.html">
            
                <a href="../advanced/plugin.html">
            
                    
                    Plugin Development
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../advanced/cluster-enhancement.html">
            
                <a href="../advanced/cluster-enhancement.html">
            
                    
                    Cluster Enhancement
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../advanced/monitor.html">
            
                <a href="../advanced/monitor.html">
            
                    
                    Monitor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="../advanced/performance.html">
            
                <a href="../advanced/performance.html">
            
                    
                    Performance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.7" data-path="../advanced/oom.html">
            
                <a href="../advanced/oom.html">
            
                    
                    Memory Leaks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.8" data-path="../advanced/attentions.html">
            
                <a href="../advanced/attentions.html">
            
                    
                    SSR Attentions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../FAQ.html">
            
                <a href="../FAQ.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Built-in Objects</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="framework-built-in-objects">Framework Built-in Objects</h2>
<p>Before read it, we first introduce some built-in basic objects in the framework, including four objects (Application, Context, Request, Response) inherited from <a href="http://koajs.com" target="_blank">Koa</a> and some objects that extend the framework (Controller, Service , Helper, Config, Logger), we will often see them in the follow-up document.</p>
<h2 id="application">Application</h2>
<p>Application is a global application object, an application only instantiate one Application, it inherited from <a href="http://koajs.com/#application" target="_blank">Koa.Application</a>, we can mount some global methods and objects on it. We can easily [extended Application object] (./extend.md#Application) in plugin or application.</p>
<h3 id="how-to-get">How to Get</h3>
<p>Application object can be accessed almost anywhere in application, the following describes a few commonly used way:</p>
<p>Almost all files (Controller, Service, Schedule, etc.) loaded by the <a href="../advanced/loader.html">Loader</a> can export a function that is called by the Loader and uses the app as a parameter:</p>
<ul>
<li><p><a href="app-start.html">App start script</a></p>
<pre><code class="lang-js"><span class="hljs-comment">// app.js</span>
<span class="hljs-built_in">module</span>.exports = app =&gt; {
  app.cache = <span class="hljs-keyword">new</span> Cache();
};
</code></pre>
</li>
<li><p><a href="controller.html">Controller file</a></p>
<pre><code class="lang-js"><span class="hljs-comment">// app/controller/user.js</span>
<span class="hljs-built_in">module</span>.exports = app =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">app</span>.<span class="hljs-title">Controller</span> </span>{
    * fetch() {
      <span class="hljs-keyword">this</span>.ctx.body = app.cache.get(<span class="hljs-keyword">this</span>.ctx.query.id);
    }
  };
};
</code></pre>
</li>
</ul>
<p>Like the <a href="http://koajs.com" target="_blank">Koa</a>, on the Context object, we can access the Application object via <code>ctx.app</code>. Use the above Controller file as an example:</p>
<pre><code class="lang-js"><span class="hljs-comment">// app/controller/user.js</span>
<span class="hljs-built_in">module</span>.exports = app =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">app</span>.<span class="hljs-title">Controller</span> </span>{
    * fetch() {
      <span class="hljs-keyword">this</span>.ctx.body = <span class="hljs-keyword">this</span>.ctx.app.cache.get(<span class="hljs-keyword">this</span>.ctx.query.id);
    }
  };
};
</code></pre>
<p>In instance objects that inherit from the Controller and Service base classes, the Application object can be accessed via <code>this.app</code>.</p>
<pre><code class="lang-js"><span class="hljs-comment">// app/controller/user.js</span>
<span class="hljs-built_in">module</span>.exports = app =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">app</span>.<span class="hljs-title">Controller</span> </span>{
    * fetch() {
      <span class="hljs-keyword">this</span>.ctx.body = <span class="hljs-keyword">this</span>.app.cache.get(<span class="hljs-keyword">this</span>.ctx.query.id);
    }
  };
};
</code></pre>
<h2 id="context">Context</h2>
<p>Context is a <strong>request level object</strong>, inherited from <a href="http://koajs.com/#context" target="_blank">Koa.Context</a>. Whenever receive a request, the framework instantiates a Context object that encapsulates the information requested by the user and provides a number of convenient ways to get the request parameter or set the response information. The framework will mount all of the <a href="service.html">Service</a> on the Context instance, and some plugins will mount some other methods and objects on it (<a href="https://github.com/eggjs/egg-sequelize" target="_blank">egg-sequelize</a> will mount all the models on the Context).</p>
<h3 id="how-to-get">How to Get</h3>
<p>The most common way to get the Context instance is in <a href="middleware.html">Middleware</a>, <a href="controller.html">Controller</a>, and <a href="service.html">Service</a>. The access method in the Controller is shown in the above example. In the Service, the access way is same as Controller. The access Context method in the Middleware of Beidou is same as <a href="http://koajs.com" target="_blank">Koa</a> framework gets the Context object in its middleware.</p>
<p>The <a href="middleware.html">Middleware</a> of Beidou also supports Koa v1 and Koa v2 two different middleware coding method, according to different method, the way to access Context instance is also slightly different:</p>
<pre><code class="lang-js"><span class="hljs-comment">// Koa v1</span>
<span class="hljs-function"><span class="hljs-keyword">function</span>* <span class="hljs-title">middleware</span>(<span class="hljs-params">next</span>) </span>{
  <span class="hljs-comment">// this is instance of Context</span>
  <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.query);
  <span class="hljs-keyword">yield</span> next;
}

<span class="hljs-comment">// Koa v2</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">middleware</span>(<span class="hljs-params">ctx, next</span>) </span>{
  <span class="hljs-comment">// ctx is instance of Context</span>
  <span class="hljs-built_in">console</span>.log(ctx.query);
}
</code></pre>
<p>In addition to the request can get the Context instance, in some non-request scenario we need to access service / model and other objects on the Context instance, we can use<code>Application.createAnonymousContext ()</code> method to create an anonymous Context instance:</p>
<pre><code class="lang-js"><span class="hljs-comment">// app.js</span>
<span class="hljs-built_in">module</span>.exports = app =&gt; {
  app.beforeStart(<span class="hljs-function"><span class="hljs-keyword">function</span>* (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">const</span> ctx = app.createAnonymousContext();
    <span class="hljs-comment">// preload before app start</span>
    <span class="hljs-keyword">yield</span> ctx.service.posts.load();
  });
}
</code></pre>
<p>Each task in <a href="schedule.html">Schedule</a> takes a Context instance as a parameter so that we can more easily execute some schedule business logic:</p>
<pre><code class="lang-js"><span class="hljs-comment">// app/schedule/refresh.js</span>
exports.task = <span class="hljs-function"><span class="hljs-keyword">function</span>* (<span class="hljs-params">ctx</span>) </span>{
  <span class="hljs-keyword">yield</span> ctx.service.posts.refresh();
};
</code></pre>
<h2 id="request--response">Request &amp; Response</h2>
<p>Request is a <strong>request level object</strong>, inherited from <a href="http://koajs.com/#request" target="_blank">Koa.Request</a>. Encapsulates the Node.js native HTTP Request object, providing a set of helper methods to get commonly used parameters of HTTP requests.</p>
<p>Response is a <strong>request level object</strong>, inherited from <a href="http://koajs.com/#response" target="_blank">Koa.Response</a>. Encapsulates the Node.js native HTTP Response object, providing a set of helper methods to set the HTTP response.</p>
<h3 id="how-to-get">How to Get</h3>
<p>We can get the Request(<code>ctx.request</code>) and Response (<code>ctx.response</code>) instances of the current request on the Context instance.</p>
<pre><code class="lang-js"><span class="hljs-comment">// app/controller/user.js</span>
<span class="hljs-built_in">module</span>.exports = app =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">app</span>.<span class="hljs-title">Controller</span> </span>{
    * fetch() {
      <span class="hljs-keyword">const</span> { app, ctx } = <span class="hljs-keyword">this</span>;
      <span class="hljs-keyword">const</span> id = ctx.request.query.id;
      ctx.response.body = app.cache.get(id);
    }
  };
};
</code></pre>
<ul>
<li><a href="http://koajs.com" target="_blank">Koa</a> will proxy some methods and properties of Request and Response on Context, see <a href="http://koajs.com/#context" target="_blank">Koa.Context</a>.</li>
<li><code>ctx.request.query.id</code> and<code>ctx.query.id</code> are equivalent in the above example , <code>ctx.response.body =</code> and <code>ctx.body =</code> are equivalent.</li>
<li>It should be noted that get the body of POST should use <code>ctx.request.body</code> instead of<code>ctx.body</code>.</li>
</ul>
<h2 id="controller">Controller</h2>
<p>Beidou provides a Controller base class and recommends that all <a href="controller.html">Controller</a> inherit from the base class. The Controller base class has the following properties:</p>
<ul>
<li><code>ctx</code> - <a href="#context">Context</a> instance of the current request.</li>
<li><code>app</code> - <a href="#application">Application</a> instance.</li>
<li><code>config</code> - application <a href="config.html">configuration</a>.</li>
<li><code>service</code> - all <a href="service.html">service</a> of application.</li>
<li><code>logger</code> - the encapsulated logger object for the current controller.</li>
</ul>
<p>In the Controller file, there are two ways to refer to the Controller base class:</p>
<pre><code class="lang-js"><span class="hljs-comment">// app/controller/user.js</span>

<span class="hljs-comment">// get from app instance (recommend)</span>
<span class="hljs-built_in">module</span>.exports = app =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">app</span>.<span class="hljs-title">Controller</span> </span>{
    <span class="hljs-comment">// implement</span>
  };
};

<span class="hljs-comment">// get from beidou</span>
<span class="hljs-keyword">const</span> beidou = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;beidou&apos;</span>);
<span class="hljs-built_in">module</span>.exports = <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">beidou</span>.<span class="hljs-title">Controller</span> </span>{
  <span class="hljs-comment">// implement</span>
};
</code></pre>
<h2 id="service">Service</h2>
<p>Beidou provides a Service base class and recommends that all <a href="service.html">Service</a> inherit from the base class.</p>
<p>The fields of the Service base class are the same as those of the <a href="#controller">Controller</a> base class, the access method is similar:</p>
<pre><code class="lang-js"><span class="hljs-comment">// app/service/user.js</span>

<span class="hljs-comment">// get from app instance (recommend)</span>
<span class="hljs-built_in">module</span>.exports = app =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">app</span>.<span class="hljs-title">Service</span> </span>{
    <span class="hljs-comment">// implement</span>
  };
};

<span class="hljs-comment">// get from beidou</span>
<span class="hljs-keyword">const</span> beidou = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;beidou&apos;</span>);
<span class="hljs-built_in">module</span>.exports = <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">beidou</span>.<span class="hljs-title">Service</span> </span>{
  <span class="hljs-comment">// implement</span>
};
</code></pre>
<h2 id="helper">Helper</h2>
<p>Helper is used to provide some useful utility functions. Its role is that we can put some commonly used functions into helper.js, so we can use JavaScript to write complex logic, avoid the logic scattered everywhere, and can be more convenient to write test cases.</p>
<p>The Helper itself is a class that has the same fields as the <a href="#controller">Controller</a> base class, and it will instantiated at each request so that all functions on the Helper can also get context of the current request.</p>
<h3 id="how-to-get">How to Get</h3>
<p>We can get the Helper(<code>ctx.helper</code>) instance of the current request on the Context instance.</p>
<pre><code class="lang-js"><span class="hljs-comment">// app/controller/user.js</span>
<span class="hljs-built_in">module</span>.exports = app =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">app</span>.<span class="hljs-title">Controller</span> </span>{
    * fetch() {
      <span class="hljs-keyword">const</span> { app, ctx } = <span class="hljs-keyword">this</span>;
      <span class="hljs-keyword">const</span> id = ctx.query.id;
      <span class="hljs-keyword">const</span> user = app.cache.get(id);
      ctx.body = ctx.helper.formatUser(user);
    }
  };
};
</code></pre>
<p>In addition, Helper instances can also be accessed in template, for example, we can get <a href="../core/security.html">security</a> plugin provided <code>shtml</code> method from template.</p>
<pre><code>// app/view/home.nj
{{ helper.shtml(value) }}
</code></pre><h3 id="custom-helper-method">Custom helper method</h3>
<p>In application development, we may often customize some helper methods, such as <code>formatUser</code> in the above example, we can use <a href="extend.html#helper">framework extension</a> to customize helper method.</p>
<pre><code class="lang-js"><span class="hljs-comment">// app/extend/helper.js</span>
<span class="hljs-built_in">module</span>.exports = {
  formatUser(user) {
    <span class="hljs-keyword">return</span> only(user, [ <span class="hljs-string">&apos;name&apos;</span>, <span class="hljs-string">&apos;phone&apos;</span> ]);
  }
};
</code></pre>
<h2 id="config">Config</h2>
<p>We recommend application development to follow the principle of configuration and code separation, put hard-coded business in configuration file, and the configuration file support different runtime environments using different configurations, the framework, plugin and application-level configurations are available via the Config object. For configuration of Beidou, read <a href="config.html">Configuration</a> in detail.</p>
<h3 id="how-to-get">How to Get</h3>
<p>We can get the config object from the Application instance via <code>app.config</code>, or get the config object via<code>this.config</code> on the instance of Controller, Service or Helper.</p>
<h2 id="logger">Logger</h2>
<p>Beidou built powerful <a href="../core/logger.html">logger</a>, it is very convenient to print a variety of levels of logs to the corresponding log file, each logger object provides 5 level methods:</p>
<ul>
<li><code>logger.debug()</code></li>
<li><code>logger.info()</code></li>
<li><code>logger.warn()</code></li>
<li><code>logger.error()</code></li>
</ul>
<p>Beidou provides a number of Logger object, we simply introduce how to get each Logger and its scenario.</p>
<h3 id="app-logger">App Logger</h3>
<p>We can get it via <code>app.logger</code>. If we want to do some application-level logging, such as logging some data in the startup phase, logging some business related information, those can be done by App Logger.</p>
<h3 id="app-corelogger">App CoreLogger</h3>
<p>We can get it via <code>app.coreLogger</code>, and we should not print logs via CoreLogger when developing applications, the framework and plugins need to print application-level logs to make it easier to distinguish from applications printed logs, the logs printed by the CoreLogger will be placed in a different file than the Logger.</p>
<h3 id="context-logger">Context Logger</h3>
<p>We can get it via <code>ctx.logger</code> from Context instance, we can see from access method, Context Logger must be related to the request, it will take current request related information (such as <code>[$userId/$ip/$traceId/${cost}ms $method $url]</code>) in the front of logs, with this information, we can quickly locate requests from logs and concatenate all logs in one request.</p>
<h3 id="context-corelogger">Context CoreLogger</h3>
<p>We can get it via <code>ctx.coreLogger</code>, the difference between the Context Logger is that only plugins and framework will log via it.</p>
<h3 id="controller-logger--service-logger">Controller Logger &amp; Service Logger</h3>
<p>We can get them via <code>this.logger</code> in Controller and Service instance, they are essentially a Context Logger, but additional file path will be added to logs, easy to locate the log print location.</p>
<h2 id="subscription">Subscription</h2>
<p>Subscription is the model for subscribing, including consumer in message broker or schedule.</p>
<p>The base class of Subscription is exported by beidou.</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> Subscription = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;beidou&apos;</span>).Subscription;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Schedule</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Subscription</span> </span>{
  <span class="hljs-comment">// This method should be implemented</span>
  <span class="hljs-comment">// subscribe can be generator function or async function</span>
  * subscribe() {}
}
</code></pre>
<p>We recommend plugin developers to implement based on this model, For example, <a href="schedule.html">Schedule</a>.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                
                <a href="env.html" class="navigation navigation-next navigation-unique" aria-label="Next page: Runtime Environment">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Built-in Objects","level":"1.4.1","depth":2,"next":{"title":"Runtime Environment","level":"1.4.2","depth":2,"path":"basic/env.md","ref":"basic/env.md","articles":[]},"previous":{"title":"Basics","level":"1.4","depth":1,"ref":"","articles":[{"title":"Built-in Objects","level":"1.4.1","depth":2,"path":"basic/objects.md","ref":"basic/objects.md","articles":[]},{"title":"Runtime Environment","level":"1.4.2","depth":2,"path":"basic/env.md","ref":"basic/env.md","articles":[]},{"title":"Configuration","level":"1.4.3","depth":2,"path":"basic/config.md","ref":"basic/config.md","articles":[]},{"title":"Plugins","level":"1.4.4","depth":2,"path":"basic/plugins.md","ref":"basic/plugins.md","articles":[]},{"title":"Middlewares","level":"1.4.5","depth":2,"path":"basic/middleware.md","ref":"basic/middleware.md","articles":[]},{"title":"Router","level":"1.4.6","depth":2,"path":"basic/router.md","ref":"basic/router.md","articles":[]},{"title":"Controller","level":"1.4.7","depth":2,"path":"basic/controller.md","ref":"basic/controller.md","articles":[]},{"title":"Service","level":"1.4.8","depth":2,"path":"basic/service.md","ref":"basic/service.md","articles":[]},{"title":"Schedule","level":"1.4.9","depth":2,"path":"basic/schedule.md","ref":"basic/schedule.md","articles":[]},{"title":"Extend","level":"1.4.10","depth":2,"path":"basic/extend.md","ref":"basic/extend.md","articles":[]},{"title":"Mock","level":"1.4.11","depth":2,"path":"basic/Mock.md","ref":"basic/Mock.md","articles":[]},{"title":"Custom startup","level":"1.4.12","depth":2,"path":"basic/app-start.md","ref":"basic/app-start.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["antsay","-sharing","styles-less","livereload"],"styles":{"website":"website-1510989186484.css"},"pluginsConfig":{"antsay":{"useIdentifier":false,"shortName":"","appId":"","key":""},"styles-less":{},"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Beidou Document","gitbook":">= 3.2.0","description":"Beidou Document"},"file":{"path":"basic/objects.md","mtime":"2017-11-17T09:28:17.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-11-18T07:04:22.028Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="https://say.alipay.net/public/antsay.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-antsay/bootstrap.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

